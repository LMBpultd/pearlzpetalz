<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pearlz Petalz</title>
  <link rel="stylesheet" href="css/PearlzPetalz.css" />
  <link rel="icon" type="image/jpeg" href="logo.jpg" />
  <meta name="description" content="Handcrafted kids' hair bands and accessories." />
</head>
<body>

  <div class="header">
    <span><a href="../"><h1 id="ppz">Pearlz_Petalz</h1></a></span>
    <div class="header-icons">
      <span id="cartIcon">๐<span id="cartCount">0</span></span>
    </div>
  </div>

  <h1>Unique Handmade Collections</h1>

  <div class="products" id="productContainer"></div>

  <div class="pagination">
    <button class="all-categories-btn"><a href="pearlz_petalz1.html" style="color: azure;">Next Page โ</a></button>
  </div>

  <div id="fullScreenModal">
    <span class="close-fullscreen" onclick="closeFullScreen()">&times;</span>
    <div id="fullScreenContent"></div>
  </div>

  <div class="footer">
    <b><a href="../" id="plg">PEARLZ_PETALZ</a></b><br /><br />
    Copyright ยฉ <span id="year"></span> Pearlz_Petalz | All Rights Reserved
  </div>

  <div id="toast">Product added successfully</div>

  <script src="js/cart.js"></script>
 <script>
  document.getElementById("year").textContent = new Date().getFullYear();
  const imageFolder = "images/Collections/";
  const container = document.getElementById("productContainer");

  function renderProducts(products, container, folder) {
    container.innerHTML = "";
    if (products.length === 0) {
      container.innerHTML = "<p>No products found!</p>";
      return;
    }

    products.forEach((item, index) => {
      if (!item.file) return;

      const mediaContainerId = `media-${index}`;
      const baseFileName = item.file; // JSON-เตฝ เดจเตฝเดเดฟเดฏ เดซเดฏเตฝ เดชเตเดฐเต
      
      // เดตเดฟเดตเดฟเดง เดซเดฏเตฝ เดชเดพเดคเตเดคเตเดเตพ
      const jpgPath = `${folder}${baseFileName}.jpg`;
      const jpegPath = `${folder}${baseFileName}.jpeg`;
      const pngPath = `${folder}${baseFileName}.png`;
      const videoPath = `${folder}${baseFileName}.mp4`;

      const card = document.createElement("div");
      card.className = "product-card";
      
      /* Logic: เดเดฆเตเดฏเด .jpg เดจเตเดเตเดเตเด, เดเดคเต เดชเดฐเดพเดเดฏเดชเตเดชเตเดเตเดเดพเตฝ .jpeg เดจเตเดเตเดเตเด, 
         เดเดคเตเด เดชเดฐเดพเดเดฏเดชเตเดชเตเดเตเดเดพเตฝ .png เดจเตเดเตเดเตเด, เดเดฒเตเดฒเดพเด เดชเดฐเดพเดเดฏเดชเตเดชเตเดเตเดเดพเตฝ เดตเตเดกเดฟเดฏเต เดชเตเดฒเต เดเตเดฏเตเดฏเตเด.
      */
      card.innerHTML = `
        <div id="${mediaContainerId}">
          <img class="product-media" 
               src="${jpgPath}" 
               alt="${item.name}" 
               onerror="checkNextFormat(this, '${jpegPath}', '${pngPath}', '${videoPath}', '${mediaContainerId}')" 
               onclick="openFullScreen(this.src, false)">
        </div>
        <div class="product-name">${item.name || 'No Name'}</div>
        <div class="product-price">โน${item.price || '0'}</div>
        <button class="add-btn" data-index="${index}" data-img="${item.file}">Add to Cart</button>
      `;
      container.appendChild(card);
    });
  }

  // เดเดฎเตเดเต เดซเตเตผเดฎเดพเดฑเตเดฑเตเดเตพ เดเดฐเตเดจเตเดจเดพเดฏเดฟ เดเตเดเตเดเต เดเตเดฏเตเดฏเดพเดจเตเดณเตเดณ เดซเดเดเตเดทเตป
  function checkNextFormat(imgElement, jpeg, png, video, containerId) {
    if (imgElement.src.endsWith('.jpg')) {
      imgElement.src = jpeg; // .jpg เดชเดฐเดพเดเดฏเดชเตเดชเตเดเตเดเดพเตฝ .jpeg เดจเตเดเตเดเตเดจเตเดจเต
    } else if (imgElement.src.endsWith('.jpeg')) {
      imgElement.src = png; // .jpeg เดชเดฐเดพเดเดฏเดชเตเดชเตเดเตเดเดพเตฝ .png เดจเตเดเตเดเตเดจเตเดจเต
    } else {
      // เดเดฒเตเดฒเดพ เดเดฎเตเดเต เดซเตเตผเดฎเดพเดฑเตเดฑเตเด เดชเดฐเดพเดเดฏเดชเตเดชเตเดเตเดเดพเตฝ เดตเตเดกเดฟเดฏเต เดฒเตเดกเต เดเตเดฏเตเดฏเตเดจเตเดจเต
      tryLoadingVideo(video, containerId);
    }
  }

  function tryLoadingVideo(videoSrc, containerId) {
    const mediaContainer = document.getElementById(containerId);
    if (mediaContainer) {
      mediaContainer.innerHTML = `
        <video class="product-media" autoplay muted loop playsinline onclick="openFullScreen('${videoSrc}', true)">
          <source src="${videoSrc}" type="video/mp4">
        </video>`;
    }
  }

  function openFullScreen(src, isVideo) {
    const modal = document.getElementById("fullScreenModal");
    const content = document.getElementById("fullScreenContent");
    if(!modal || !content) return;

    modal.style.display = "flex";
    if (isVideo) {
      content.innerHTML = `<video controls autoplay style="max-width:100%; max-height:90vh;"><source src="${src}" type="video/mp4"></video>`;
    } else {
      content.innerHTML = `<img src="${src}" style="max-width:100%; max-height:90vh;">`;
    }
  }

  function closeFullScreen() {
    const modal = document.getElementById("fullScreenModal");
    if(modal) modal.style.display = "none";
  }

  window.onclick = function(event) {
    const modal = document.getElementById("fullScreenModal");
    if (event.target == modal) closeFullScreen();
  }

  fetch("products.json")
    .then(res => res.json())
    .then(products => {
      const reversedProducts = [...products].reverse();
      const pageProducts = reversedProducts.slice(0, 36); 
      renderProducts(pageProducts, container, imageFolder);
      
      if(typeof setupCart === 'function') {
        setupCart(pageProducts, container, imageFolder);
      }
    })
    .catch(err => {
      console.error("Error loading JSON:", err);
    });
</script>
</body>
</html>