<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pearlz Petalz | Handmade Collections</title>
  <link rel="stylesheet" href="css/PearlzPetalz.css" />
  <link rel="icon" type="image/jpeg" href="logo.jpg" />
  <meta name="description" content="Handcrafted kids' hair bands and accessories." />
</head>
<body>

  <div class="header">
    <span><a href="../"><h1 id="ppz">Pearlz_Petalz</h1></a></span>
    <div class="header-icons">
      <span id="cartIcon">üõí<span id="cartCount">0</span></span>
    </div>
  </div>

  <h1>Unique Handmade Collections</h1>

  <div class="products" id="productContainer"></div>

  <div id="floatingCart" class="floating-cart" onclick="showCart()">
    üõí<span id="floatingCartCount">0</span>
  </div>

  <div class="pagination" style="text-align: center;">
    <a href="#" id="prevLink" style="color: azure; text-decoration: none;">
      <button id="prevPage" class="all-categories-btn" style="display:none; margin-right: 10px;">‚Üê Previous Page</button>
    </a>
    <span id="pageInfo" style="font-weight: bold; margin: 0 15px;"></span>
    <a href="#" id="nextLink" style="color: azure; text-decoration: none;">
      <button id="nextPage" class="all-categories-btn" style="display:none; margin-left: 10px;">Next Page ‚Üí </button>
    </a>
  </div>

  <div id="fullScreenModal">
    <span class="close-fullscreen" onclick="closeFullScreen()">&times;</span>
    <div id="fullScreenContent"></div>
  </div>

  <div class="footer">
    <b><a href="../Gallery/" id="plg">PEARLZ_PETALZ</a></b><br /><br />
    Copyright ¬© <span id="year"></span> Pearlz_Petalz | All Rights Reserved
  </div>

  <div id="toast">Product added successfully</div>

  <script src="js/cart.js"></script>
  <script>
    // ‡¥ï‡¥±‡¥®‡µç‡¥±‡µç ‡¥á‡¥Ø‡µº ‡¥∏‡µÜ‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
    document.getElementById("year").textContent = new Date().getFullYear();
    
    const imageFolder = "images/Collections/";
    const container = document.getElementById("productContainer");
    
    // URL-‡µΩ ‡¥®‡¥ø‡¥®‡µç‡¥®‡µç ‡¥™‡µá‡¥ú‡µç ‡¥®‡¥Æ‡µç‡¥™‡µº ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡µÅ‡¥®‡µç‡¥®‡µÅ
    const urlParams = new URLSearchParams(window.location.search);
    let currentPage = parseInt(urlParams.get('page')) || 1;
    const productsPerPage = 42;

    // ‡¥™‡µç‡¥∞‡µã‡¥°‡¥ï‡µç‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥≤‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥´‡¥Ç‡¥ó‡µç‚Äå‡¥∑‡µª
    function renderProducts(products, container, folder) {
      container.innerHTML = "";
      if (products.length === 0) {
        container.innerHTML = "<p>No products found!</p>";
        return;
      }
      products.forEach((item, index) => {
        if (!item.file) return;
        const mediaContainerId = `media-${index}`;
        const card = document.createElement("div");
        card.className = "product-card";
        card.innerHTML = `
          <div id="${mediaContainerId}">
            <img class="product-media" src="${folder}${item.file}.jpg" 
                 onerror="checkNextFormat(this, '${folder}${item.file}.jpeg', '${folder}${item.file}.png', '${folder}${item.file}.mp4', '${mediaContainerId}')" 
                 onclick="openFullScreen(this.src, false)">
          </div>
          <div class="product-name">${item.name || 'No Name'}</div>
          <div class="product-price">‚Çπ${item.price || '0'}</div>
          <button class="add-btn" data-index="${index}">Add to Cart</button>
        `;
        container.appendChild(card);
      });
    }

    // ‡¥á‡¥Æ‡µá‡¥ú‡µç ‡¥´‡µã‡µº‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥ì‡¥∞‡µã‡¥®‡µç‡¥®‡¥æ‡¥Ø‡¥ø ‡¥ö‡µÜ‡¥ï‡µç‡¥ï‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
    function checkNextFormat(imgElement, jpeg, png, video, containerId) {
      if (imgElement.src.endsWith('.jpg')) imgElement.src = jpeg;
      else if (imgElement.src.endsWith('.jpeg')) imgElement.src = png;
      else tryLoadingVideo(video, containerId);
    }

    // ‡¥µ‡µÄ‡¥°‡¥ø‡¥Ø‡µã ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥´‡¥Ç‡¥ó‡µç‚Äå‡¥∑‡µª
    function tryLoadingVideo(videoSrc, containerId) {
      const mediaContainer = document.getElementById(containerId);
      if (mediaContainer) {
        mediaContainer.innerHTML = `<video class="product-media" autoplay muted loop playsinline onclick="openFullScreen('${videoSrc}', true)"><source src="${videoSrc}" type="video/mp4"></video>`;
      }
    }

    // ‡¥´‡µÅ‡µæ ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µÄ‡µª ‡¥µ‡µç‡¥Ø‡µÇ ‡¥ì‡¥™‡µç‡¥™‡µ∫ ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡µª
    function openFullScreen(src, isVideo) {
      const modal = document.getElementById("fullScreenModal");
      const content = document.getElementById("fullScreenContent");
      modal.style.display = "flex";
      content.innerHTML = isVideo ? `<video controls autoplay style="max-height:90vh;"><source src="${src}" type="video/mp4"></video>` : `<img src="${src}" style="max-height:90vh;">`;
    }

    // ‡¥´‡µÅ‡µæ ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µÄ‡µª ‡¥µ‡µç‡¥Ø‡µÇ ‡¥ï‡µç‡¥≤‡µã‡¥∏‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡µª
    function closeFullScreen() { 
      const modal = document.getElementById("fullScreenModal");
      if (modal) modal.style.display = "none"; 
    }

    // ‡¥Æ‡µã‡¥°‡¥≤‡¥ø‡¥®‡µç ‡¥™‡µÅ‡¥±‡¥§‡µç‡¥§‡µç ‡¥ï‡µç‡¥≤‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡¥æ‡µΩ ‡¥ï‡µç‡¥≤‡µã‡¥∏‡µç ‡¥Ü‡¥ï‡¥æ‡µª
    window.onclick = function(event) { 
      if (event.target == document.getElementById("fullScreenModal")) closeFullScreen(); 
    }

    // ‡¥™‡µç‡¥∞‡µã‡¥°‡¥ï‡µç‡¥±‡µç‡¥±‡µç ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥´‡µÜ‡¥ö‡µç‡¥ö‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
    fetch("products.json")
      .then(res => res.json())
      .then(products => {
        const reversedProducts = [...products].reverse();
        const startIndex = (currentPage - 1) * productsPerPage;
        const pageProducts = reversedProducts.slice(startIndex, startIndex + productsPerPage);
        renderProducts(pageProducts, container, imageFolder);
        if(typeof setupCart === 'function') setupCart(pageProducts, container, imageFolder);
        handlePagination(products.length);
      });

    // ‡¥™‡µá‡¥ú‡¥ø‡¥®‡µá‡¥∑‡µª ‡¥¨‡¥ü‡µç‡¥ü‡¥£‡µÅ‡¥ï‡µæ ‡¥®‡¥ø‡¥Ø‡¥®‡µç‡¥§‡µç‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
    function handlePagination(totalProducts) {
      const totalPages = Math.ceil(totalProducts / productsPerPage);
      document.getElementById("pageInfo").textContent = `Page ${currentPage} of ${totalPages}`;
      if (currentPage > 1) {
        document.getElementById("prevPage").style.display = "inline-block";
        document.getElementById("prevLink").href = `?page=${currentPage - 1}`;
      }
      if (currentPage < totalPages) {
        document.getElementById("nextPage").style.display = "inline-block";
        document.getElementById("nextLink").href = `?page=${currentPage + 1}`;
      }
    }

    // ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µã‡µæ ‡¥≤‡µã‡¥ú‡¥ø‡¥ï‡µç (‡¥™‡µç‡¥∞‡¥ß‡¥æ‡¥® ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥ô‡µç‡¥ô‡µæ ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ‡¥Ø‡¥æ‡¥£‡µç)
    window.onscroll = function() {
      const floatingCart = document.getElementById("floatingCart");
      const cartModal = document.getElementById("cartModal");
      const fullScreenModal = document.getElementById("fullScreenModal");

      // 1. ‡¥´‡µÅ‡µæ ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µÄ‡µª ‡¥µ‡µç‡¥Ø‡µÇ ‡¥§‡µÅ‡¥±‡¥®‡µç‡¥®‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥Æ‡µç‡¥™‡µã‡µæ ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µã‡µæ ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡¥æ‡µΩ ‡¥Ö‡¥§‡µç ‡¥ï‡µç‡¥≤‡µã‡¥∏‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
      if (fullScreenModal && fullScreenModal.style.display === "flex") {
        closeFullScreen();
      }

      // 2. ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µã‡µæ ‡¥™‡µä‡¥∏‡¥ø‡¥∑‡µª ‡¥Ö‡¥®‡µÅ‡¥∏‡¥∞‡¥ø‡¥ö‡µç‡¥ö‡µç ‡¥´‡µç‡¥≤‡µã‡¥ü‡µç‡¥ü‡¥ø‡¥Ç‡¥ó‡µç ‡¥ï‡¥æ‡µº‡¥ü‡µç‡¥ü‡µÅ‡¥Ç ‡¥Æ‡µã‡¥°‡¥≤‡µÅ‡¥Ç ‡¥®‡¥ø‡¥Ø‡¥®‡µç‡¥§‡µç‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
      if (window.scrollY > 100) {
        floatingCart.classList.add("show");
        if (cartModal) cartModal.remove(); // ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µã‡µæ ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥Æ‡µç‡¥™‡µã‡µæ ‡¥ï‡¥æ‡µº‡¥ü‡µç‡¥ü‡µç ‡¥µ‡¥ø‡µª‡¥°‡µã ‡¥ï‡µç‡¥≤‡µã‡¥∏‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ
      } else {
        floatingCart.classList.remove("show");
      }
    };
</script>
</body>
</html>