<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pearlz Petalz</title>
  <link rel="stylesheet" href="css/PearlzPetalz.css" />
  <link rel="icon" type="image/jpeg" href="logo.jpg" />
  <meta name="description" content="Handcrafted with love and care, my unique, affordable kids' hair bands are more than accessories they're trusted keepsakes, made to capture childhood moments with quality and heart." />
</head>
<body>
  <div class="header">
    <span><a href="../"><h1 id="ppz">Pearlz_Petalz</h1></a></span>
    <div class="header-icons">
      <span id="cartIcon">üõí<span id="cartCount">0</span></span>
    </div>
  </div>

  <h1>Unique Handmade Collections</h1>
  <div class="products" id="productContainer"></div>
  
  <div class="pagination">
    <button class="all-categories-btn" id="prevPage">
      <a href="index.html" style="color: azure;">‚Üê Previous Page</a>
    </button>
    <button class="all-categories-btn" id="nextPage" style="display:none;">
      <a href="pearlz_petalz2.html" style="color: azure;">Next Page ‚Üí</a>
    </button>
  </div>

  <div id="fullScreenModal">
    <span class="close-fullscreen" onclick="closeFullScreen()">&times;</span>
    <div id="fullScreenContent"></div>
  </div>

  <div class="footer">
    <b><a href="../" id="plg">PEARLZ_PETALZ</a></b><br /><br />
    Copyright ¬© <span id="year"></span> Pearlz_Petalz | All Rights Reserved
  </div>

  <div id="toast">Product added successfully</div>

  <script src="js/cart.js"></script>
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();

    const imageFolder = "images/Collections/";
    const container = document.getElementById("productContainer");

    // 1. ‡¥™‡µç‡¥∞‡µã‡¥°‡¥ï‡µç‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥≤‡¥ø‡¥∏‡µç‡¥±‡µç‡¥±‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥´‡¥Ç‡¥ó‡µç‚Äå‡¥∑‡µª
    function renderProducts(products, container, folder) {
      container.innerHTML = "";
      if (products.length === 0) {
        container.innerHTML = "<p>No products found!</p>";
        return;
      }

      products.forEach((item, index) => {
        if (!item.file) return;

        const mediaContainerId = `media-${index}`;
        const baseFileName = item.file;
        
        const jpgPath = `${folder}${baseFileName}.jpg`;
        const jpegPath = `${folder}${baseFileName}.jpeg`;
        const pngPath = `${folder}${baseFileName}.png`;
        const videoPath = `${folder}${baseFileName}.mp4`;

        const card = document.createElement("div");
        card.className = "product-card";
        
        card.innerHTML = `
          <div id="${mediaContainerId}">
            <img class="product-media" 
                 src="${jpgPath}" 
                 alt="${item.name}" 
                 onerror="checkNextFormat(this, '${jpegPath}', '${pngPath}', '${videoPath}', '${mediaContainerId}')" 
                 onclick="openFullScreen(this.src, false)">
          </div>
          <div class="product-name">${item.name || 'No Name'}</div>
          <div class="product-price">‚Çπ${item.price || '0'}</div>
          <button class="add-btn" data-index="${index}" data-img="${item.file}">Add to Cart</button>
        `;
        container.appendChild(card);
      });
    }

    // 2. ‡¥´‡µã‡µº‡¥Æ‡¥æ‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥ì‡¥∞‡µã‡¥®‡µç‡¥®‡¥æ‡¥Ø‡¥ø ‡¥™‡¥∞‡¥ø‡¥∂‡µã‡¥ß‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥´‡¥Ç‡¥ó‡µç‚Äå‡¥∑‡µª
    function checkNextFormat(imgElement, jpeg, png, video, containerId) {
      if (imgElement.src.endsWith('.jpg')) {
        imgElement.src = jpeg;
      } else if (imgElement.src.endsWith('.jpeg')) {
        imgElement.src = png;
      } else {
        tryLoadingVideo(video, containerId);
      }
    }

    // 3. ‡¥µ‡µÄ‡¥°‡¥ø‡¥Ø‡µã ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡¥®‡µÅ‡¥≥‡µç‡¥≥ ‡¥´‡¥Ç‡¥ó‡µç‚Äå‡¥∑‡µª
    function tryLoadingVideo(videoSrc, containerId) {
      const mediaContainer = document.getElementById(containerId);
      if (mediaContainer) {
        mediaContainer.innerHTML = `
          <video class="product-media" autoplay muted loop playsinline onclick="openFullScreen('${videoSrc}', true)">
            <source src="${videoSrc}" type="video/mp4">
          </video>`;
      }
    }

    // 4. ‡¥´‡µÅ‡µæ ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µÄ‡µª ‡¥´‡¥Ç‡¥ó‡µç‚Äå‡¥∑‡¥®‡µÅ‡¥ï‡µæ
    function openFullScreen(src, isVideo) {
      const modal = document.getElementById("fullScreenModal");
      const content = document.getElementById("fullScreenContent");
      if(!modal || !content) return;

      modal.style.display = "flex";
      if (isVideo) {
        content.innerHTML = `<video controls autoplay style="max-width:100%; max-height:90vh;"><source src="${src}" type="video/mp4"></video>`;
      } else {
        content.innerHTML = `<img src="${src}" style="max-width:100%; max-height:90vh;">`;
      }
    }

    function closeFullScreen() {
      const modal = document.getElementById("fullScreenModal");
      if(modal) modal.style.display = "none";
    }

    window.onclick = function(event) {
      const modal = document.getElementById("fullScreenModal");
      if (event.target == modal) closeFullScreen();
    }

    // 5. ‡¥°‡¥æ‡¥±‡µç‡¥± ‡¥´‡µÜ‡¥ö‡µç‡¥ö‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡µç ‡¥∏‡µç‡¥≤‡µà‡¥∏‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ (36 ‡¥Æ‡µÅ‡¥§‡µΩ 72 ‡¥µ‡¥∞‡µÜ)
    fetch("products.json")
      .then((res) => res.json())
      .then((products) => {
        const reversedProducts = [...products].reverse();
        const pageProducts = reversedProducts.slice(36, 72);

        renderProducts(pageProducts, container, imageFolder);
        
        if(typeof setupCart === 'function') {
           setupCart(pageProducts, container, imageFolder);
        }

        // 72 ‡¥â‡µΩ‡¥™‡µç‡¥™‡¥®‡µç‡¥®‡¥ô‡µç‡¥ô‡¥≥‡¥ø‡µΩ ‡¥ï‡µÇ‡¥ü‡µÅ‡¥§‡µΩ ‡¥â‡¥£‡µç‡¥ü‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥Æ‡¥æ‡¥§‡µç‡¥∞‡¥Ç Next ‡¥¨‡¥ü‡µç‡¥ü‡µ∫ ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
        if (products.length > 72) {
          document.getElementById("nextPage").style.display = "inline-block";
        } else {
          document.getElementById("nextPage").style.display = "none";
        }
      })
      .catch((err) => console.error("Failed to load products.json:", err));
  </script>
</body>
</html>