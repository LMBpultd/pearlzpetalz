<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pearlz Petalz | Gallery</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: Arial, sans-serif;
            color: white;
        }

        .gallery {
            display: flex;
            width: 100%;
            flex-wrap: wrap;
            justify-content: flex-start;
            padding: 5px;
            box-sizing: border-box;
        }

        .gallery-item {
            width: 19%; 
            margin: 0.5%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            border-radius: 5px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        @media screen and (max-width: 768px) {
            .gallery-item {
                width: 48%;
                margin: 1%;
            }
        }

        /* Pagination Styling */
        .pagination {
            text-align: center;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        .page-btn {
            background-color: #333;
            color: white;
            border: 1px solid #555;
            padding: 8px 16px;
            cursor: pointer;
            border-radius: 5px;
            text-decoration: none;
            font-size: 14px;
        }

        .page-btn:hover {
            background-color: #555;
        }

        /* Full Screen Popup */
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: #000;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .popup-content {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 40px;
            cursor: pointer;
            z-index: 2100;
        }

        .ppl {
            position: fixed;
            width: 50px;
            height: 50px;
            bottom: 25px;
            right: 25px;
            border-radius: 50%;
            z-index: 999;
            background: white;
        }

        .ppl img {
            width: 100%;
            border-radius: 50%;
        }
    </style>
</head>
<body>

    <div class="gallery" id="gallery"></div>

    <div class="pagination">
        <a href="#" id="prevLink" style="display: none;"><button class="page-btn">← Previous</button></a>
        <span id="pageInfo"></span>
        <a href="#" id="nextLink" style="display: none;"><button class="page-btn">Next →</button></a>
    </div>

    <div class="popup" id="popup">
        <span class="close-btn" onclick="closePopup()">&times;</span>
        <div id="popupContent" style="width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;"></div>
    </div>

    <div class="ppl">
        <a href="../pearlz_petalz/">
            <img src="../pearlz_petalz/logo.jpg" alt="logo" onerror="this.src='../pearlz_petalz/logos/logo.jpg'" />
        </a>
    </div>

    <script>
        const gallery = document.getElementById("gallery");
        const popup = document.getElementById("popup");
        const popupContent = document.getElementById("popupContent");
        const path = "../pearlz_petalz/images/Collections/";

        // URL-ൽ നിന്ന് പേജ് നമ്പർ എടുക്കുന്നു
        const urlParams = new URLSearchParams(window.location.search);
        let currentPage = parseInt(urlParams.get('page')) || 1;
        const productsPerPage = 50;

        fetch("../pearlz_petalz/products.json")
            .then((res) => res.json())
            .then((products) => {
                const reversedProducts = [...products].reverse();
                
                // പേജിനേഷൻ ലോജിക്
                const startIndex = (currentPage - 1) * productsPerPage;
                const pageProducts = reversedProducts.slice(startIndex, startIndex + productsPerPage);
                
                renderGallery(pageProducts);
                handlePagination(products.length);
            });

        function renderGallery(products) {
            gallery.innerHTML = ""; // പഴയ ചിത്രങ്ങൾ മാറ്റാൻ
            products.forEach((product, index) => {
                const containerId = `item-${index}`;
                const wrapper = document.createElement("div");
                wrapper.id = containerId;
                wrapper.style.display = "contents"; 
                
                const img = document.createElement("img");
                img.className = "gallery-item";
                img.src = `${path}${product.file}.jpg`;
                
                img.onerror = () => checkNextFormat(img, product.file, containerId);
                img.onclick = () => openPopup(img.src, false);
                
                gallery.appendChild(wrapper);
                wrapper.appendChild(img);
            });
        }

        function checkNextFormat(imgElement, fileName, containerId) {
            if (imgElement.src.endsWith(".jpg")) {
                imgElement.src = `${path}${fileName}.jpeg`;
            } else if (imgElement.src.endsWith(".jpeg")) {
                imgElement.src = `${path}${fileName}.png`;
            } else {
                tryLoadingVideo(fileName, containerId);
            }
        }

        function tryLoadingVideo(fileName, containerId) {
            const container = document.getElementById(containerId);
            const videoSrc = `${path}${fileName}.mp4`;
            if (container) {
                container.innerHTML = `<video class="gallery-item" autoplay muted loop playsinline onclick="openPopup('${videoSrc}', true)"><source src="${videoSrc}" type="video/mp4"></video>`;
            }
        }

        function handlePagination(totalProducts) {
            const totalPages = Math.ceil(totalProducts / productsPerPage);
            document.getElementById("pageInfo").textContent = `Page ${currentPage} of ${totalPages}`;
            
            if (currentPage > 1) {
                document.getElementById("prevLink").style.display = "inline";
                document.getElementById("prevLink").href = `?page=${currentPage - 1}`;
            }
            if (currentPage < totalPages) {
                document.getElementById("nextLink").style.display = "inline";
                document.getElementById("nextLink").href = `?page=${currentPage + 1}`;
            }
        }

        function openPopup(src, isVideo) {
            popup.style.display = "flex";
            if (isVideo) {
                popupContent.innerHTML = `<video class="popup-content" controls autoplay loop><source src="${src}" type="video/mp4"></video>`;
            } else {
                popupContent.innerHTML = `<img src="${src}" class="popup-content">`;
            }
        }

        function closePopup() {
            popup.style.display = "none";
            popupContent.innerHTML = "";
        }

        window.onscroll = function() {
            if (popup.style.display === "flex") closePopup();
        };
    </script>
</body>
</html>